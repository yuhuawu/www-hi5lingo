---
import "../styles/global.css";
import { languages, defaultLang } from '../i18n/ui';
import { useTranslations } from '../i18n/utils';

interface Props {
	title: string;
	description?: string;
	lang?: keyof typeof languages;
}

const { 
	title, 
	description = "Hi5Lingo - Learn Chinese effectively with our interactive platform. Join thousands of students mastering Mandarin today.",
	lang = defaultLang
} = Astro.props;

const t = useTranslations(lang as any);
const currentPath = Astro.url.pathname;

function getLocalizedPath(targetLang: string) {
	const segments = currentPath.split('/').filter(Boolean);
	const locales = Object.keys(languages);
	
	// If current path starts with a locale, remove it
	if (locales.includes(segments[0])) {
		segments.shift();
	}
	
	const cleanPath = segments.join('/');
	
	if (targetLang === defaultLang) {
		return `/${cleanPath}`;
	}
	return `/${targetLang}/${cleanPath}`;
}
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title} | Hi5Lingo</title>
	</head>
	<body class="bg-slate-50 text-slate-900 antialiased">
		<header class="bg-white shadow-sm sticky top-0 z-50">
			<nav class="container mx-auto px-4 py-4 flex justify-between items-center">
				<a href={`/${lang === defaultLang ? '' : lang}`} class="text-2xl font-bold text-indigo-600">Hi5Lingo</a>
				<div class="flex items-center space-x-4">
					<!-- Language Switcher -->
					<div class="relative group">
						<button class="flex items-center space-x-1 text-slate-600 hover:text-indigo-600 focus:outline-none py-2">
							<span>{languages[lang as keyof typeof languages]}</span>
							<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
							</svg>
						</button>
						<div class="absolute right-0 mt-0 w-32 bg-white rounded-md shadow-lg py-1 hidden group-hover:block border border-slate-100">
							{Object.entries(languages).map(([l, label]) => (
								<a 
									href={getLocalizedPath(l)}
									class={`block px-4 py-2 text-sm text-slate-700 hover:bg-indigo-50 hover:text-indigo-600 ${l === lang ? 'font-bold' : ''}`}
								>
									{label}
								</a>
							))}
						</div>
					</div>

					<a href={`/${lang === defaultLang ? '' : lang + '/'}blog`} class="hover:text-indigo-600">{t('nav.blog')}</a>
					<a href="#" class="hover:text-indigo-600">{t('nav.login')}</a>
					<a href="#" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">{t('nav.get_started')}</a>
				</div>
			</nav>
		</header>
		
		<main>
			<slot />
		</main>

		<footer class="bg-slate-900 text-slate-300 py-12 mt-20">
			<div class="container mx-auto px-4 grid md:grid-cols-3 gap-8">
				<div>
					<h3 class="text-white text-lg font-bold mb-4">Hi5Lingo</h3>
					<p>{t('footer.about_desc')}</p>
				</div>
				<div>
					<h4 class="text-white font-semibold mb-4">{t('footer.quick_links')}</h4>
					<ul class="space-y-2">
						<li><a href={`/${lang === defaultLang ? '' : lang}`} class="hover:text-white">{t('footer.home')}</a></li>
						<li><a href={`/${lang === defaultLang ? '' : lang + '/'}blog`} class="hover:text-white">{t('footer.blog')}</a></li>
						<li><a href="#" class="hover:text-white">{t('footer.pricing')}</a></li>
						<li><a href="#" class="hover:text-white">{t('nav.login')}</a></li>
					</ul>
				</div>
				<div>
					<h4 class="text-white font-semibold mb-4">{t('footer.contact')}</h4>
					<p>support@hi5lingo.com</p>
				</div>
			</div>
			<div class="container mx-auto px-4 mt-8 pt-8 border-t border-slate-800 text-center text-sm">
				<p>&copy; {new Date().getFullYear()} Hi5Lingo. {t('footer.rights')}</p>
			</div>
		</footer>
	</body>
</html>
